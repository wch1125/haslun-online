<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0a0a0f">
  <title>SPACE CAPITAL // HANGAR BAY</title>
  <!-- SVG favicon - SC mark (consistent across all pages) -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><rect width='64' height='64' fill='%230A0A0F'/><text x='8' y='44' font-size='32' font-family='monospace' font-weight='bold' fill='%23FF2975'>SC</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=VT323&family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Shared theme variables -->
  <link rel="stylesheet" href="../css/theme.css?v=20260108">
  <!-- Canonical CRT App Shell -->
  <link rel="stylesheet" href="../css/crt-shell.css?v=20260108">
  <!-- UI Overhaul -->
  <link rel="stylesheet" href="../css/ui-overhaul.css?v=20260108">
  <!-- Core styles including dial selector -->
  <link rel="stylesheet" href="../css/ship-select.css?v=20260108b">
  <!-- Ship behavior states -->
  <link rel="stylesheet" href="../css/ship-states.css?v=20260108">
  
  <style>
    /* Page-specific overrides */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      /* Miami chromatic black */
      background: linear-gradient(
        180deg,
        #14000b 0%,
        #0a0011 45%,
        #050008 100%
      );
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    /* ═══════════════════════════════════════════════════════════════════
       SHIP CARD STYLES (from space-capital.html)
       ═══════════════════════════════════════════════════════════════════ */
    
    .ship-card {
      background: rgba(10, 10, 15, 0.95);
      border: 2px solid var(--hm-magenta, #FF2975);
      padding: 0.75rem;
      position: relative;
      cursor: pointer;
      clip-path: polygon(0 8px, 8px 0, 100% 0, 100% calc(100% - 8px), calc(100% - 8px) 100%, 0 100%);
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .ship-card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(255, 41, 117, 0.08) 0%, transparent 50%);
      pointer-events: none;
      z-index: 1;
    }
    
    .ship-card::after {
      content: '';
      position: absolute;
      inset: 0;
      background:
        repeating-linear-gradient(0deg, rgba(255, 255, 255, 0.015), rgba(255, 255, 255, 0.015) 1px, transparent 1px, transparent 3px),
        repeating-linear-gradient(90deg, rgba(255, 41, 117, 0.01), rgba(255, 41, 117, 0.01) 1px, transparent 1px, transparent 4px);
      pointer-events: none;
      mix-blend-mode: overlay;
      z-index: 10;
    }
    
    .ship-card.is-active {
      border-color: var(--hm-cyan, #00FFFF);
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.4), inset 0 0 20px rgba(0, 255, 255, 0.1);
    }
    
    /* Ship Header */
    .ship-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      z-index: 2;
    }
    
    .ship-callsign {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .ship-ticker {
      font-family: 'VT323', monospace;
      font-size: 1.25rem;
      font-weight: bold;
      letter-spacing: 0.1em;
      color: var(--hm-magenta, #FF2975);
      text-shadow: 0 0 10px var(--hm-magenta);
    }
    
    .ship-class {
      font-family: 'VT323', monospace;
      font-size: 0.625rem;
      letter-spacing: 0.15em;
      color: rgba(255, 255, 255, 0.5);
      text-transform: uppercase;
      padding: 0.2rem 0.4rem;
      border: 1px solid rgba(255, 41, 117, 0.3);
      background: rgba(0, 0, 0, 0.4);
    }
    
    .score-badge {
      min-width: 28px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'VT323', monospace;
      font-size: 0.875rem;
      font-weight: bold;
      color: var(--score-color, #888);
      background: rgba(0, 0, 0, 0.6);
      border: 2px solid var(--score-color, #888);
      text-shadow: 0 0 8px var(--score-color);
      padding: 0 0.25rem;
    }
    
    .ship-pnl {
      font-family: 'VT323', monospace;
      font-size: 1rem;
      font-weight: bold;
      letter-spacing: 0.05em;
    }
    
    .ship-pnl.positive { color: var(--hm-cyan, #00FFFF); text-shadow: 0 0 10px var(--hm-cyan); }
    .ship-pnl.negative { color: var(--hm-magenta, #FF2975); text-shadow: 0 0 10px var(--hm-magenta); }
    
    /* Ship Display */
    .ship-display {
      height: 100px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 41, 117, 0.2);
      overflow: hidden;
    }
    
    .ship-display::before {
      content: '';
      position: absolute;
      inset: 0;
      background: 
        linear-gradient(90deg, transparent 49%, rgba(255, 41, 117, 0.1) 49%, rgba(255, 41, 117, 0.1) 51%, transparent 51%),
        linear-gradient(0deg, transparent 49%, rgba(255, 41, 117, 0.1) 49%, rgba(255, 41, 117, 0.1) 51%, transparent 51%);
      background-size: 20px 20px;
      pointer-events: none;
      z-index: 1;
    }
    
    .signal-indicator {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      z-index: 5;
    }
    
    .ship-sprite-wrap {
      position: relative;
      z-index: 2;
    }
    
    .ship-sprite-img {
      width: 80px;
      height: 80px;
      object-fit: contain;
      image-rendering: pixelated;
      filter: drop-shadow(0 0 10px var(--ship-color, #FF2975));
    }
    
    .engine-glow {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      z-index: 3;
    }
    
    .timeframe-dots {
      position: absolute;
      bottom: 6px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 6px;
      z-index: 5;
    }
    
    .timeframe-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(136, 136, 136, 0.5);
    }
    
    .timeframe-dot.mood-bull { background: var(--hm-cyan, #00FFFF); box-shadow: 0 0 6px var(--hm-cyan); }
    .timeframe-dot.mood-ok { background: rgba(0, 255, 255, 0.5); }
    .timeframe-dot.mood-flat { background: rgba(136, 136, 136, 0.6); }
    .timeframe-dot.mood-bear { background: var(--hm-magenta, #FF2975); box-shadow: 0 0 6px var(--hm-magenta); }
    
    /* Behavior Badges */
    .behavior-badges {
      display: flex;
      justify-content: center;
      gap: 0.375rem;
      position: relative;
      z-index: 2;
    }
    
    .behavior-badge {
      font-family: 'VT323', monospace;
      font-size: 0.5rem;
      letter-spacing: 0.1em;
      padding: 0.2rem 0.4rem;
      border: 1px solid rgba(0, 255, 255, 0.3);
      color: rgba(0, 255, 255, 0.7);
      background: rgba(0, 0, 0, 0.4);
    }
    
    .behavior-badge.active { border-color: var(--hm-cyan); color: var(--hm-cyan); box-shadow: 0 0 6px rgba(0, 255, 255, 0.3); }
    .behavior-badge.idle { border-color: rgba(136, 136, 136, 0.4); color: rgba(136, 136, 136, 0.7); }
    .behavior-badge.warning { border-color: rgba(255, 230, 0, 0.6); color: rgba(255, 230, 0, 0.9); }
    .behavior-badge.critical { border-color: var(--hm-magenta); color: var(--hm-magenta); }
    .behavior-badge.ok { border-color: rgba(0, 255, 255, 0.4); color: rgba(0, 255, 255, 0.8); }
    
    /* Telemetry Bars */
    .telemetry-bars {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      position: relative;
      z-index: 2;
    }
    
    .telem-bar-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .telem-bar-label {
      font-family: 'VT323', monospace;
      font-size: 0.5rem;
      color: rgba(255, 255, 255, 0.5);
      letter-spacing: 0.1em;
      width: 60px;
      text-align: right;
    }
    
    .telem-bar {
      flex: 1;
      height: 6px;
      background: rgba(255, 255, 255, 0.1);
      position: relative;
      overflow: hidden;
    }
    
    .telem-bar-center {
      position: absolute;
      left: 50%;
      top: 0;
      bottom: 0;
      width: 1px;
      background: rgba(255, 255, 255, 0.3);
    }
    
    .telem-bar-fill {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      transition: width 0.3s ease;
    }
    
    .telem-bar-fill.trend { background: linear-gradient(90deg, var(--hm-magenta) 0%, var(--hm-cyan) 100%); }
    .telem-bar-fill.momentum { background: linear-gradient(90deg, var(--hm-magenta) 0%, var(--hm-cyan) 100%); }
    .telem-bar-fill.volatility { background: linear-gradient(90deg, var(--hm-cyan) 0%, rgba(255, 230, 0, 0.9) 50%, var(--hm-magenta) 100%); }
    
    /* Journey Range (52W) */
    .journey-range {
      position: relative;
      z-index: 2;
      padding: 0.25rem 0;
    }
    
    .journey-range-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.2rem;
    }
    
    .journey-range-label {
      font-family: 'VT323', monospace;
      font-size: 0.5rem;
      color: rgba(255, 255, 255, 0.5);
      letter-spacing: 0.1em;
    }
    
    .journey-range-pct {
      font-family: 'VT323', monospace;
      font-size: 0.625rem;
      color: var(--hm-cyan, #00FFFF);
    }
    
    .journey-range-bar {
      height: 6px;
      background: linear-gradient(90deg, var(--hm-magenta) 0%, rgba(255, 230, 0, 0.8) 50%, var(--hm-cyan) 100%);
      position: relative;
      margin-bottom: 0.2rem;
    }
    
    .journey-range-marker {
      position: absolute;
      top: -2px;
      width: 3px;
      height: 10px;
      background: white;
      transform: translateX(-50%);
      box-shadow: 0 0 6px rgba(255, 255, 255, 0.8);
    }
    
    .journey-range-labels {
      display: flex;
      justify-content: space-between;
    }
    
    .journey-range-value {
      font-family: 'VT323', monospace;
      font-size: 0.5rem;
      color: rgba(255, 255, 255, 0.4);
    }
    
    /* Ship Telemetry Footer */
    .ship-telemetry {
      display: flex;
      justify-content: space-around;
      padding-top: 0.5rem;
      border-top: 1px solid rgba(255, 41, 117, 0.2);
      position: relative;
      z-index: 2;
    }
    
    .telemetry-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.1rem;
    }
    
    .telemetry-label {
      font-family: 'VT323', monospace;
      font-size: 0.4375rem;
      color: rgba(255, 255, 255, 0.4);
      letter-spacing: 0.1em;
    }
    
    .telemetry-value {
      font-family: 'VT323', monospace;
      font-size: 0.75rem;
      color: var(--hm-cyan, #00FFFF);
    }
    
    /* ═══════════════════════════════════════════════════════════════════
       END SHIP CARD STYLES
       ═══════════════════════════════════════════════════════════════════ */
    
    /* Parallax layers */
    .parallax-layer {
      position: fixed;
      inset: -10px;
      pointer-events: none;
      z-index: 0;
    }
    
    .layer-bg {
      background: radial-gradient(
        ellipse at center,
        rgba(20, 0, 11, 0.3) 0%,
        rgba(5, 0, 8, 0.8) 70%
      );
    }
    
    .watercolor-layer {
      z-index: 1;
      opacity: 0.85;
    }
    
    /* Loading state */
    .loading-state {
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #0a0c0f;
      z-index: 9999;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    
    .loading-state.hidden {
      opacity: 0;
      visibility: hidden;
    }
    
    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 3px solid rgba(255, 41, 117, 0.2);
      border-top-color: #FF2975;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .loading-text {
      margin-top: 1rem;
      font-family: 'VT323', monospace;
      font-size: 1rem;
      color: rgba(255, 41, 117, 0.8);
      letter-spacing: 0.15em;
    }
    
    /* Navigation header */
    .hangar-nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1.5rem;
      background: rgba(10, 10, 15, 0.95);
      border-bottom: 2px solid rgba(255, 41, 117, 0.4);
      z-index: 1000;
      backdrop-filter: blur(8px);
    }
    
    .hangar-nav::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--hm-magenta);
      box-shadow: 0 0 15px var(--hm-magenta);
    }
    
    .hangar-nav-logo {
      font-family: 'VT323', monospace;
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--hm-magenta);
      letter-spacing: 0.15em;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .hangar-nav-logo::before {
      content: '[SC]';
      color: var(--hm-cyan);
    }
    
    .hangar-nav-links {
      display: flex;
      gap: 1.5rem;
    }
    
    .hangar-nav-link {
      font-family: 'VT323', monospace;
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.6);
      text-decoration: none;
      letter-spacing: 0.1em;
      transition: color 0.2s ease;
    }
    
    .hangar-nav-link:hover {
      color: var(--hm-cyan);
    }
    
    .hangar-nav-link.active {
      color: var(--hm-magenta);
    }
    
    /* Main content area */
    .dial-page {
      padding-top: 50px;
      min-height: 100vh;
      position: relative;
      z-index: 5;
      display: flex;
      flex-direction: column;
    }
    
    /* Page header */
    .page-header {
      text-align: center;
      padding: 1rem 1.5rem;
      background: rgba(10, 10, 15, 0.8);
      border-bottom: 1px solid rgba(255, 41, 117, 0.2);
      flex-shrink: 0;
    }
    
    .page-title {
      font-family: 'VT323', monospace;
      font-size: 1.5rem;
      color: var(--hm-magenta);
      letter-spacing: 0.2em;
      text-shadow: 0 0 15px rgba(255, 41, 117, 0.5);
      margin: 0;
    }
    
    .page-subtitle {
      font-family: 'VT323', monospace;
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.4);
      letter-spacing: 0.3em;
      margin-top: 0.25rem;
    }
    
    /* Dial mount needs explicit height */
    #dialMount {
      flex: 1;
      min-height: 500px;
    }
    
    /* CRT scanlines overlay */
    .scanlines {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 9998;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0, 0, 0, 0.08) 2px,
        rgba(0, 0, 0, 0.08) 4px
      );
    }
    
    /* Mobile nav collapse */
    @media (max-width: 768px) {
      .hangar-nav-links {
        gap: 1rem;
      }
      
      .hangar-nav-link {
        font-size: 0.75rem;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell watercolor-ambient">
    <!-- Layer 0: Base gradient -->
    <div class="parallax-layer layer-bg" data-depth="0"></div>
    
    <!-- Layer 1: Watercolor ambient wash -->
    <div class="watercolor-layer parallax-layer" data-depth="0.1"></div>
    
    <!-- Layer 2: CRT effects -->
    <div class="crt-layer">
      <div class="crt-noise parallax-layer" data-depth="0.15"></div>
    </div>
    
    <!-- Layer 3: UI Content -->
    <div class="ui-layer">
  
      <!-- Loading State -->
      <div class="loading-state" id="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">INITIALIZING HANGAR SYSTEMS...</div>
      </div>
  
      <!-- Navigation -->
      <nav class="hangar-nav">
        <div class="hangar-nav-logo">SPACE CAPITAL</div>
        <div class="hangar-nav-links">
          <a href="space-capital.html" class="hangar-nav-link">FLEET</a>
          <a href="ship-select.html" class="hangar-nav-link active">HANGAR</a>
          <a href="derivatives.html" class="hangar-nav-link">MISSIONS</a>
        </div>
      </nav>
      
      <!-- Main Page -->
      <div class="dial-page">
        <header class="page-header">
          <h1 class="page-title">// SELECT VESSEL //</h1>
          <p class="page-subtitle">SWIPE TO BROWSE // TAP TO SELECT</p>
        </header>
        
        <!-- Dial Selector Mount Point -->
        <div id="dialMount" class="dial-mount"></div>
        
        <!-- Action Buttons -->
        <div class="dial-actions">
          <button id="enterHangarBtn" class="dial-action-btn primary">ENTER HANGAR</button>
        </div>
      </div>
      
      <!-- CRT Scanlines -->
      <div class="scanlines"></div>
    </div>
  </div>

  <!-- Core modules -->
  <script src="../js/core/store.js?v=20260108"></script>
  <script src="../js/core/constants.js?v=20260108"></script>
  <script src="../js/data/ship-data.js?v=20260108"></script>
  <script src="../js/data/ticker-profiles.js?v=20260108"></script>
  <script src="../js/ui/dial-selector.js?v=20260108"></script>
  
  <script>
    (function() {
      'use strict';
      
      // ═══════════════════════════════════════════════════════════════════
      // NO FAKE STATS - All data derived from market only
      // ═══════════════════════════════════════════════════════════════════
      
      // Color palette for ships (can be derived from volatility/momentum later)
      const DEFAULT_COLOR = '#FF2975';
      
      let statsData = {};
      let fleetData = {};
      let dial = null;
      
      // ─────────────────────────────────────────────────────────────────────
      // DATA LOADING
      // ─────────────────────────────────────────────────────────────────────
      
      async function loadStatsData() {
        try {
          const response = await fetch('../data/stats.json');
          if (!response.ok) throw new Error('Stats not found');
          const data = await response.json();
          return data.stats || data;
        } catch (err) {
          console.warn('[Hangar] Stats unavailable:', err);
          return {};
        }
      }
      
      async function loadFleetData() {
        try {
          const response = await fetch('../data/telemetry/fleet.json');
          if (!response.ok) throw new Error('Fleet not found');
          const data = await response.json();
          // Convert array to map by ticker
          const map = {};
          (data.ships || []).forEach(ship => {
            map[ship.ticker] = ship;
          });
          return map;
        } catch (err) {
          console.warn('[Hangar] Fleet unavailable:', err);
          return {};
        }
      }
      
      // ─────────────────────────────────────────────────────────────────────
      // MARKET-DERIVED CLASSIFICATION (no fake archetypes)
      // ─────────────────────────────────────────────────────────────────────
      
      /**
       * Derives ship classification ONLY from market data
       * Returns: { regime, score, color }
       * - regime: UPTREND | DOWNTREND | BREAKOUT | CHOP | RANGE (derived from price action)
       * - score: 0-100 overall strength score
       * - color: derived from signal state
       */
      function deriveShipClass(ticker, stats, fleet) {
        const s = stats || {};
        const f = fleet || {};
        
        // Market-derived metrics
        const price = s.current || f.price || 0;
        const high52 = s.high_52w || price * 1.2;
        const low52 = s.low_52w || price * 0.8;
        const range52 = high52 - low52;
        
        // Position in 52-week range (0-1)
        const rangePosition = range52 > 0 ? (price - low52) / range52 : 0.5;
        
        // Volatility proxy: 52-week range as % of low
        const volatilityProxy = low52 > 0 ? range52 / low52 : 0.5;
        const isHighVol = volatilityProxy >= 0.8; // 80%+ range = high volatility
        
        // Momentum from returns
        const mom1y = s.return_1y || 0;
        const mom3m = s.return_3m || 0;
        const mom1m = s.return_1m || 0;
        
        // Trend detection
        const isStrongUp = mom3m >= 15 || mom1y >= 40;
        const isStrongDown = mom3m <= -15 || mom1y <= -40;
        const isTrending = Math.abs(mom3m) >= 15 || Math.abs(mom1y) >= 30;
        
        // Derive regime label (not fake archetype - describes market state)
        let regime = 'RANGE';
        if (isTrending && isStrongUp) regime = 'UPTREND';
        else if (isTrending && isStrongDown) regime = 'DOWNTREND';
        else if (isHighVol && isTrending) regime = 'BREAKOUT';
        else if (isHighVol && !isTrending) regime = 'CHOP';
        
        // Overall score (0-100) derived from multiple factors
        // Higher = stronger position + momentum
        const positionScore = rangePosition * 40;  // 0-40 from range position
        const momentumScore = Math.min(30, Math.max(0, (mom3m + 30) / 60 * 30)); // 0-30 from 3m momentum
        const trendScore = Math.min(30, Math.max(0, (mom1y + 50) / 350 * 30)); // 0-30 from 1y momentum
        const score = Math.round(positionScore + momentumScore + trendScore);
        
        // Color derived from signal state (bull/bear/neutral from fleet data)
        const signalState = f.signalState || 'neutral';
        const signalColors = {
          bull: '#00FFFF',   // Cyan for bullish
          bear: '#FF2975',   // Magenta for bearish
          neutral: '#888888' // Gray for neutral
        };
        const color = signalColors[signalState] || DEFAULT_COLOR;
        
        return { regime, score, color, rangePosition, volatilityProxy };
      }
      
      // ─────────────────────────────────────────────────────────────────────
      // CARD RENDERER - Uses only market-derived data
      // ─────────────────────────────────────────────────────────────────────
      
      function renderCard(ticker) {
        // Get market data
        const stats = statsData[ticker] || {};
        const fleet = fleetData[ticker] || {};
        
        // Derive classification from market data (no fake archetypes)
        const derived = deriveShipClass(ticker, stats, fleet);
        
        // Extract all data points
        const price = stats.current || fleet.price || 0;
        const chgPct = fleet.chgPct ?? stats.return_1d ?? 0;
        const pnlClass = chgPct >= 0 ? 'positive' : 'negative';
        
        // Telemetry
        const trend = fleet.trend ?? 0;
        const momentum = fleet.momentum ?? 0;
        const volatility = fleet.volatility ?? 0.5;
        const activity = fleet.activity ?? 0.5;
        const signalState = fleet.signalState || 'neutral';
        const visual = fleet.visual || { glow: 0.5, thrust: 0.3, damage: 0 };
        
        // 52-week range
        const high52w = stats.high_52w || price * 1.2;
        const low52w = stats.low_52w || price * 0.8;
        const range52w = high52w - low52w;
        const position52w = range52w > 0 ? ((price - low52w) / range52w * 100) : 50;
        const clampedPosition = Math.max(0, Math.min(100, position52w));
        
        // Historical returns
        const return_1d = stats.return_1d ?? 0;
        const return_1w = stats.return_1w ?? 0;
        const return_1m = stats.return_1m ?? 0;
        const return_3m = stats.return_3m ?? 0;
        
        // Behavior badges
        const thrustState = visual.thrust > 0.5 ? 'THRUST' : 'DRIFT';
        const thrustClass = visual.thrust > 0.5 ? 'active' : 'idle';
        const stabilityState = volatility > 0.5 ? 'EXTREME' : 'STABLE';
        const stabilityClass = volatility > 0.5 ? 'warning' : 'ok';
        const hullState = visual.damage > 0.3 ? 'DAMAGED' : 'HULL OK';
        const hullClass = visual.damage > 0.3 ? 'critical' : 'ok';
        
        // Signal colors
        const signalColors = { bull: '#00FFFF', bear: '#FF2975', neutral: '#666' };
        const signalColor = signalColors[signalState] || signalColors.neutral;
        
        // Mood class helper
        const getMood = (val) => {
          if (val > 5) return 'mood-bull';
          if (val > 0) return 'mood-ok';
          if (val > -5) return 'mood-flat';
          return 'mood-bear';
        };
        
        // Glow intensity
        const glowIntensity = Math.max(0.3, visual.glow || 0.5);
        const thrustLength = 20 + (visual.thrust * 30);
        
        // Score badge color (derived from score)
        const scoreColor = derived.score >= 70 ? '#00FFFF' : 
                          derived.score >= 40 ? '#FFE600' : '#FF2975';
        
        const card = document.createElement('button');
        card.type = 'button';
        card.className = `dial-card ship-card ${pnlClass}`;
        card.dataset.ticker = ticker;
        card.style.cssText = `--ship-glow: ${glowIntensity}; --ship-color: ${derived.color}; --signal-color: ${signalColor};`;
        
        card.innerHTML = `
          <!-- Header -->
          <div class="ship-header">
            <div class="ship-callsign">
              <span class="ship-ticker" style="color: ${derived.color}; text-shadow: 0 0 ${10 * glowIntensity}px ${derived.color};">${ticker}</span>
              <span class="ship-class">${derived.regime}</span>
            </div>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
              <div class="score-badge" style="--score-color: ${scoreColor}">${derived.score}</div>
              <div class="ship-pnl ${pnlClass}">
                ${chgPct >= 0 ? '+' : ''}${chgPct.toFixed(1)}%
              </div>
            </div>
          </div>
          
          <!-- Ship Display -->
          <div class="ship-display">
            <div class="signal-indicator" style="background: ${signalColor}; box-shadow: 0 0 10px ${signalColor};"></div>
            <div class="ship-sprite-wrap">
              <img class="ship-sprite-img" 
                   src="../assets/ships/animated/gifs/${ticker}_idle.gif"
                   alt="${ticker}"
                   onerror="this.src='../assets/ships/static/Unclaimed-Drone-ship.png'" />
            </div>
            <div class="engine-glow" style="
              background: linear-gradient(to bottom, ${shipClass.color}, transparent);
              height: ${thrustLength}px;
              opacity: ${0.4 + activity * 0.6};
            "></div>
            <!-- Timeframe dots -->
            <div class="timeframe-dots">
              <div class="timeframe-dot ${getMood(return_1d)}" title="1D"></div>
              <div class="timeframe-dot ${getMood(return_1w)}" title="1W"></div>
              <div class="timeframe-dot ${getMood(return_1m)}" title="1M"></div>
              <div class="timeframe-dot ${getMood(return_3m)}" title="3M"></div>
            </div>
          </div>

          <!-- Behavior Badges -->
          <div class="behavior-badges">
            <span class="behavior-badge ${thrustClass}">${thrustState}</span>
            <span class="behavior-badge ${stabilityClass}">${stabilityState}</span>
            <span class="behavior-badge ${hullClass}">${hullState}</span>
          </div>

          <!-- Telemetry Bars -->
          <div class="telemetry-bars">
            <div class="telem-bar-row">
              <span class="telem-bar-label">TREND</span>
              <div class="telem-bar">
                <div class="telem-bar-fill trend" style="width: ${50 + trend * 50}%;"></div>
                <div class="telem-bar-center"></div>
              </div>
            </div>
            <div class="telem-bar-row">
              <span class="telem-bar-label">MOMENTUM</span>
              <div class="telem-bar">
                <div class="telem-bar-fill momentum" style="width: ${50 + momentum * 50}%;"></div>
                <div class="telem-bar-center"></div>
              </div>
            </div>
            <div class="telem-bar-row">
              <span class="telem-bar-label">VOLATILITY</span>
              <div class="telem-bar">
                <div class="telem-bar-fill volatility" style="width: ${volatility * 100}%;"></div>
              </div>
            </div>
          </div>

          <!-- 52W Range -->
          <div class="journey-range">
            <div class="journey-range-header">
              <span class="journey-range-label">52W RANGE</span>
              <span class="journey-range-pct">${clampedPosition.toFixed(0)}%</span>
            </div>
            <div class="journey-range-bar">
              <div class="journey-range-marker" style="left: ${clampedPosition}%;"></div>
            </div>
            <div class="journey-range-labels">
              <span class="journey-range-value">$${low52w.toFixed(2)}</span>
              <span class="journey-range-value">$${high52w.toFixed(2)}</span>
            </div>
          </div>

          <!-- Footer Telemetry -->
          <div class="ship-telemetry">
            <div class="telemetry-item">
              <div class="telemetry-label">PRICE</div>
              <div class="telemetry-value">$${price.toFixed(2)}</div>
            </div>
            <div class="telemetry-item">
              <div class="telemetry-label">SIGNAL</div>
              <div class="telemetry-value" style="color: ${signalColor};">${signalState.toUpperCase()}</div>
            </div>
            <div class="telemetry-item">
              <div class="telemetry-label">ACTIVITY</div>
              <div class="telemetry-value">${(activity * 100).toFixed(0)}%</div>
            </div>
          </div>
        `;
        
        return card;
      }
      
      // ─────────────────────────────────────────────────────────────────────
      // NAVIGATION HANDLER - Only fires on explicit select
      // ─────────────────────────────────────────────────────────────────────
      
      function navigateToHangar(ticker) {
        // Commit to Store
        if (window.Store) {
          Store.set({
            activeTicker: ticker,
            activeMission: null
          });
          console.log('[Hangar] Ship committed to Store:', ticker);
        }
        
        // Navigate
        window.location.href = `hangar.html?ship=${ticker}`;
      }
      
      // ─────────────────────────────────────────────────────────────────────
      // INITIALIZATION
      // ─────────────────────────────────────────────────────────────────────
      
      async function init() {
        // Load data
        const [stats, fleet] = await Promise.all([
          loadStatsData(),
          loadFleetData()
        ]);
        statsData = stats;
        fleetData = fleet;
        
        // Get available tickers from actual data (not hardcoded list)
        // Priority: SHIP_SPRITES (assets), fleetData (telemetry), statsData (market)
        const tickers = Object.keys(window.SHIP_SPRITES || fleetData || statsData);
        
        if (tickers.length === 0) {
          console.error('[Hangar] No ships available');
          return;
        }
        
        // Get previously selected ticker
        const selectedTicker = window.Store?.get('activeTicker') || 
                              localStorage.getItem('parallax_selected_ship') ||
                              tickers[0];
        
        // Initialize watercolor
        if (window.HangarWatercolor) {
          HangarWatercolor.setupPage('hangar');
        }
        
        // Hide loading
        document.getElementById('loading').classList.add('hidden');
        
        // Create dial selector
        const mount = document.getElementById('dialMount');
        
        dial = window.DialSelector.create({
          mount: mount,
          items: tickers,
          renderCard: renderCard,
          windowSize: 7,
          
          onActiveChange: (ticker) => {
            // Update Store with current focus (but don't navigate)
            if (window.Store) {
              Store.set({ activeTicker: ticker });
            }
            console.log('[Dial] Active:', ticker);
          },
          
          onSelect: (ticker) => {
            // User tapped center card - navigate
            navigateToHangar(ticker);
          }
        });
        
        // Set initial position to selected ticker
        if (selectedTicker && tickers.includes(selectedTicker)) {
          dial.setActiveTicker(selectedTicker);
        }
        
        // Enter Hangar button
        document.getElementById('enterHangarBtn').addEventListener('click', () => {
          const ticker = dial.getActiveTicker();
          navigateToHangar(ticker);
        });
        
        console.log('[Hangar] Dial selector initialized with', tickers.length, 'ships');
      }
      
      // Start
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
      
    })();
  </script>
</body>
</html>
